import{R as se,r as o,F as ae,M as ne,a1 as oe,c as B,a2 as le,X as L,d as G,l as r,B as b,k as re}from"./index-nY8nNody.js";import{I as ie,s as ce}from"./index-D0bJF_an.js";import{M as de}from"./index-CNiHaKH8.js";function V(e){return["small","middle","large"].includes(e)}function q(e){return e?typeof e=="number"&&!Number.isNaN(e):!1}const K=se.createContext({latestIndex:0}),ue=K.Provider,pe=e=>{let{className:s,index:t,children:a,split:n,style:i}=e;const{latestIndex:u}=o.useContext(K);return a==null?null:o.createElement(o.Fragment,null,o.createElement("div",{className:s,style:i},a),t<u&&n&&o.createElement("span",{className:`${s}-split`},n))};var me=function(e,s){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(e);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(t[a[n]]=e[a[n]]);return t};const he=o.forwardRef((e,s)=>{var t;const{getPrefixCls:a,direction:n,size:i,className:u,style:p,classNames:l,styles:d}=ae("space"),{size:m=i??"small",align:h,className:f,rootClassName:I,children:T,direction:x="horizontal",prefixCls:z,split:P,style:O,wrap:y=!1,classNames:w,styles:j}=e,S=me(e,["size","align","className","rootClassName","children","direction","prefixCls","split","style","wrap","classNames","styles"]),[k,v]=Array.isArray(m)?m:[m,m],E=V(v),N=V(k),A=q(v),c=q(k),R=ne(T,{keepEmpty:!0}),H=h===void 0&&x==="horizontal"?"center":h,g=a("space",z),[J,X,Q]=oe(g),Y=B(g,u,X,`${g}-${x}`,{[`${g}-rtl`]:n==="rtl",[`${g}-align-${H}`]:H,[`${g}-gap-row-${v}`]:E,[`${g}-gap-col-${k}`]:N},f,I,Q),M=B(`${g}-item`,(t=w==null?void 0:w.item)!==null&&t!==void 0?t:l.item);let D=0;const Z=R.map((C,_)=>{var F;C!=null&&(D=_);const te=(C==null?void 0:C.key)||`${M}-${_}`;return o.createElement(pe,{className:M,key:te,index:_,split:P,style:(F=j==null?void 0:j.item)!==null&&F!==void 0?F:d.item},C)}),ee=o.useMemo(()=>({latestIndex:D}),[D]);if(R.length===0)return null;const $={};return y&&($.flexWrap="wrap"),!N&&c&&($.columnGap=k),!E&&A&&($.rowGap=v),J(o.createElement("div",Object.assign({ref:s,className:Y,style:Object.assign(Object.assign(Object.assign({},$),p),O)},S),o.createElement(ue,{value:ee},Z)))}),U=he;U.Compact=le;var fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 256H736v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zm-200 0H360v-72h304v72z"}}]},name:"delete",theme:"filled"},ye=function(s,t){return o.createElement(L,G({},s,{ref:t,icon:fe}))},ge=o.forwardRef(ye),xe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z"}}]},name:"edit",theme:"filled"},ke=function(s,t){return o.createElement(L,G({},s,{ref:t,icon:xe}))},ve=o.forwardRef(ke);function W({textButton:e,handleKeyDown:s,placeholderText:t,value:a,onChange:n,onPressEnter:i,onClick:u}){return r.jsxs(U.Compact,{style:{width:"100%"},children:[r.jsx(ie,{onChange:n,value:a,onKeyDown:s,placeholder:t,onPressEnter:i}),r.jsxs(b,{type:"primary",onClick:u,children:[e," "]})]})}function Ce({setEditingText:e,editingText:s,storedTasks:t,editingIndex:a,saveEdit:n,handleChangeComplete:i,editTask:u,handleDelete:p}){return r.jsx("ul",{children:t.map(l=>r.jsx("li",{style:{display:"flex",alignItems:"center"},children:a===l.id?r.jsx(r.Fragment,{children:r.jsx(W,{value:s,onChange:d=>e(d.target.value),onPressEnter:()=>n(l),style:{flex:1},textButton:"Update",onClick:()=>n(l)})}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"task-text",onClick:()=>i(l),style:{textDecoration:l.isCompleted?"line-through":"none",cursor:"pointer",flex:1},children:l.title}),r.jsx(b,{type:"primary",onClick:d=>{d.stopPropagation(),u(l)},children:r.jsx(ve,{})}),r.jsx(b,{type:"primary",onClick:d=>{d.stopPropagation(),p(l)},children:r.jsx(ge,{})})]})},l.id))})}const Te=e=>async(t,a)=>{if(t.trim()===""){a(!0);return}const n={title:t};await e.createTask(n)},we=e=>async(t,a)=>{try{await e.deleteTask(t.id)}catch(n){a(n)}},je=e=>o.useCallback(async(s,t,a)=>{if(s)try{const n=await e.getTasks();t(n)}catch(n){a(n)}else console.log("Token is missing")},[e]),Se=(e,s,t,a,n,i,u)=>async l=>{const d=s.map(m=>m.id===l.id?{...m,title:t}:m);await e.editTaskApi({title:t},l.id,u),a(d),n(null),i("")},Ee=e=>async(t,a,n,i,u)=>{const p=u.map(l=>l.id===t.id?{...l,isCompleted:!l.isCompleted}:{...l,isCompleted:l.isCompleted});try{await e.patchTaskApi(t.id,a)}catch(l){n(l),i(p)}};class Ne{constructor(s,t){this.baseURL=s,this.token=t}async _request(s,t="GET",a=null){const n={Authorization:`Bearer ${this.token}`,...a&&{"Content-Type":"application/json"}},i=await fetch(`${this.baseURL}${s}`,{method:t,headers:n,body:a?JSON.stringify(a):null});if(!i.ok)throw new Error(`Request failed: ${i.status}`);return i.status!==204?i.json():null}async getTasks(){return this._request("/api/todos")}async createTask(s){return this._request("/api/todos","POST",s)}async deleteTask(s){return this._request(`/api/todos/${s}`,"DELETE")}async editTaskApi(s,t){return this._request(`/api/todos/${t}`,"PATCH",s)}async patchTaskApi(s){return this._request(`/api/todos/${s}/isCompleted`,"PATCH")}}function ze(){const[e,s]=o.useState(""),[t,a]=o.useState([]),[n,i]=o.useState(null),[u,p]=o.useState(""),[l,d]=o.useState(!1),m=re(),h=o.useMemo(()=>localStorage.getItem("myToken"),[]),f=o.useMemo(()=>new Ne("https://todo-redev.herokuapp.com",h),[h]),I=Ee(f),T=Te(f),x=je(f),z=we(f),P=Se(f,t,u,a,i,p,h),O=o.useCallback(c=>{ce.error(c.message),console.error(c)},[]),y=o.useCallback(async()=>{h&&await x(h,a)},[h,x]);o.useEffect(()=>{y()},[y]);const w=c=>{m(c)},j=c=>{s(c.target.value)},S=async c=>{c.key==="Enter"&&(await T(e,d),s(""),f.getTasks(),y())},k=async()=>{await T(e,d),s(""),y()},v=async c=>{await z(c,x),y()},E=c=>{i(c.id),p(c.title)},N=async c=>{await I(c,h,O,a,t),y()},A=()=>{localStorage.removeItem("myToken"),w("/login")};return r.jsxs(r.Fragment,{children:[r.jsxs("section",{className:"container",children:[r.jsx("h1",{children:"Get things done!"}),r.jsx(W,{value:e,setVisible:d,fetchData:x,addTask:T,handleKeyDown:S,task:e,placeholderText:"What is the task today?",onChange:j,onKeyDown:S,textButton:"Add task",onClick:k}),t.length>0&&r.jsx(Ce,{storedTasks:t,editingIndex:n,editingText:u,setEditingText:p,saveEdit:P,handleChangeComplete:N,editTask:E,handleDelete:v}),r.jsx(b,{type:"primary",onClick:A,children:"Log out"})]}),r.jsx(de,{title:"Please inter task",open:l,onOk:()=>d(!1),onCancel:()=>d(!1)})]})}export{ze as TaskPage};
